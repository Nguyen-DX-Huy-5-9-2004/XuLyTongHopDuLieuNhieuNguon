@{
    ViewData["Title"] = "Home Page";
}
@model DsDHTI16A6HN.Models.DbConnectionInfo
@*Nhận 1 đối tươngkk DbConnectionInfo từ HomeController để lưu và tái sử dụng các thông tin kết nối*@
@{
    ViewBag.Title = "Trang chính";
    var databases = ViewBag.Databases as List<string> ?? new List<string>();
    var tables = ViewBag.Tables as List<string> ?? new List<string>();
    var tableData = ViewBag.TableData as List<DsDHTI16A6HN.Models.TableRow> ?? new List<DsDHTI16A6HN.Models.TableRow>();
}
<style>
    .tdh {
        text-align: right;
        width: 86px;
    }

    .rong190 {
        width: 190px;
    }
</style>
<h2>Kết nối CSDL</h2>
<form method="post" asp-action="Connect">
    <table>
        <tr>
            <td class="tdh"><label>Nhập sever: </label></td>
            <td><input type="text" name="Server" placeholder="Server/IP" value="@Model?.Server" /></td
            <td class="tdh"><label>User: </label></td>
                        <td><input type="text" name="User" placeholder="User" value="@Model?.User" /></td>
                        <td class="tdh"><label>Password: </label></td>
                        <td><input type="password" name="Password" placeholder="Password" value="@Model?.Password" /></td>
                        <td class="tdh"><button type="submit" formaction="/Home/Connect">Kết nối</button></td>
                    </tr>
                    <tr>
                        <td><label>Database: </label></td>
                        <td>
                            <select name="SelectedDatabase" class="rong190">
                                <option value="">-- Chọn Database --</option>
                    @foreach (var db in databases)
                    {
                                        <option value="@db" selected="@(db == Model.SelectedDatabase ? "selected" : null)">@db</option>
                    }
                            </select>
                        </td>
                        <td class="tdh">
                            <button type="submit" formaction="/Home/LoadTables">Tải bảng</button>
                        </td>
                        <td>
                            <select name="SelectedTable" class="rong190">
                                <option value="">-- Chọn bảng --</option>
                    @foreach (var tb in tables)
                    {
                                        <option value="@tb" selected="@(tb == Model.SelectedTable ? "selected" : null)">@tb</option>
                    }
                            </select>

                        </td>
                        <td class="tdh"><button type="submit" formaction="/Home/ShowTable">Hiển thị</button></td>
                    </tr>
                </table>
            </form>
@if (!string.IsNullOrEmpty(ViewBag.Error as string))
{
                    <div style="color:red">@ViewBag.Error</div>
}

@if (!string.IsNullOrEmpty(ViewBag.Message as string))
{
                    <div style="color:green">@ViewBag.Message</div>
}
@if (ViewBag.Error != null)
{
                    <div style="color: red;">@ViewBag.Error</div>

                    <div style="margin-top: 10px;">
                        <p><strong>Thông tin kết nối hiện tại:</strong></p>
                        <ul>
                            <li><strong>Server:</strong> @ViewBag.Server</li>
                            <li><strong>User:</strong> @ViewBag.User</li>
                            <li><strong>Password:</strong> @ViewBag.Password</li>
                            <li><strong>Database:</strong> @ViewBag.SelectedDatabase</li>
                            <li><strong>Table:</strong> @ViewBag.SelectedTable</li>
                        </ul>
                    </div>
}

@if (tableData.Count > 0)
{
                    <h3>Thêm / Sửa / Xoá bản ghi:</h3>
                    <form method="post">
                        <table>
                            <tr>
                                <td><input type="text" name="newRow.MSSV" placeholder="MSSV" /></td>
                                <td><input type="text" name="newRow.HoDem" placeholder="Họ đệm" /></td>
                                <td><input type="text" name="newRow.LopDanhNghia" placeholder="Lớp danh nghĩa" /></td>
                                <td><input type="number" step="0.01" name="newRow.DiemTrungBinh" placeholder="Điểm trung bình" /></td>

                            </tr>
                            <tr>
                                <td>
                                    <button type="submit" formaction="/Home/InsertRow">Thêm</button>

                                </td>
                                <td>
                                    <button type="submit" formaction="/Home/UpdateRow">Sửa</button>
                                </td>
                                <td>
                                    <button type="submit" formaction="/Home/DeleteRow">Xoá</button>
                                </td>
                            </tr>
                        </table>
                        </form>
<input type="hidden" name="Server" value="@Model?.Server" />
<input type="hidden" name="User" value="@Model?.User" />
<input type="hidden" name="Password" value="@Model?.Password" />
<input type="hidden" name="SelectedDatabase" value="@Model?.SelectedDatabase" />
<input type="hidden" name="SelectedTable" value="@Model?.SelectedTable" />

                    <h3>Dữ liệu bảng:</h3>
                    <table border="1" cellpadding="5" cellspacing="0">
                        <thead style="background-color:#f2f2f2;">
                            <tr>
                                <th>MSSV</th>
                                <th>Họ đệm</th>
                                <th>Lớp danh nghĩa</th>
                                <th>Điểm trung bình</th>
                            </tr>
                        </thead>
                        <tbody>
            @foreach (var row in tableData)
            {
                                    <tr>
                                        <td>@row.MSSV</td>
                                        <td>@row.HoDem</td>
                                        <td>@row.LopDanhNghia</td>
                                        <td>@row.DiemTrungBinh</td>
                                    </tr>
            }
                        </tbody>
                    </table>
}
@if (!string.IsNullOrEmpty(ViewBag.Error as string))
{
                    <div style="color:red">@ViewBag.Error</div>
}

@if (!string.IsNullOrEmpty(ViewBag.Message as string))
{
                    <div style="color:green">@ViewBag.Message</div>
}
